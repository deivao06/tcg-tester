<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div id="app">
        <div v-if="game">
            <div class="row">
                <div class="game">
                    <div class="player2">
                        <div class="hand">
                            <img 
                                v-for="card in game.player2.hand" 
                                :src="card.asset.src"
                                :width="CONSTANTS.CARD.SIZES.WIDTH" 
                                :height="CONSTANTS.CARD.SIZES.HEIGHT"
                                :class="{'selected-card': card == game.activePlayer.selectedCard}" 
                                @click="SelectCard(card)"
                                @mouseover="hoveredCard = card"
                                @mouseleave="hoveredCard = null"
                            >
                        </div>
                        <div class="slots back">
                            <div 
                                class="slot structure" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="structureClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.STRUCTURE_SLOT_1, CONSTANTS.CARD.TYPES.STRUCTURE, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.structureSlot1" 
                                        :src="game.player2.structureSlot1.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.structureSlot1"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.STRUCTURE.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot utility" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="utilityClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UTILITY_SLOT, CONSTANTS.CARD.TYPES.UTILITY, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.utilitySlot" 
                                        :src="game.player2.utilitySlot.asset.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.utilitySlot"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UTILITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot structure" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="structureClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.STRUCTURE_SLOT_2, CONSTANTS.CARD.TYPES.STRUCTURE, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.structureSlot2" 
                                        :src="game.player2.structureSlot2.asset.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.structureSlot2"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.STRUCTURE.name}}</span>
                                </div>
                            </div>
                            <div class="slot discard" :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}">
                                <div class="info">
                                    <img v-if="game.player2.discard.length" :src="game.player2.discard[game.player2.discard.length - 1].asset.src" width="100%" height="100%">
                                    <span>Discard: {{game.player2.discard.length}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="slots front">
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_1, CONSTANTS.CARD.TYPES.UNITY, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.unitySlot1" 
                                        :src="game.player2.unitySlot1.asset.src"
                                        :class="{'selected-card': game.player2.unitySlot1 == game.activePlayer.selectedCard && game.isAttackPhase()}"
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.unitySlot1"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_2, CONSTANTS.CARD.TYPES.UNITY, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.unitySlot2" 
                                        :src="game.player2.unitySlot2.asset.src" 
                                        :class="{'selected-card': game.player2.unitySlot2 == game.activePlayer.selectedCard && game.isAttackPhase()}"
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.unitySlot2"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer2"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_3, CONSTANTS.CARD.TYPES.UNITY, game.player2)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player2.unitySlot3" 
                                        :src="game.player2.unitySlot3.asset.src" 
                                        :class="{'selected-card': game.player2.unitySlot3 == game.activePlayer.selectedCard && game.isAttackPhase()}"
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player2.unitySlot3"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div class="slot deck" :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}">
                                <div class="info">
                                    <img v-if="game.player2.deck.cards.length > 0" :src="game.player2.deck.back.src" width="100%" height="100%">
                                    <span>Deck: {{game.player2.deck.cards.length}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="player1">
                        <div class="slots front">
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_1, CONSTANTS.CARD.TYPES.UNITY, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.unitySlot1" 
                                        :src="game.player1.unitySlot1.asset.src"
                                        :class="{'selected-card': game.player1.unitySlot1 == game.activePlayer.selectedCard && game.isAttackPhase()}"  
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.unitySlot1"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_2, CONSTANTS.CARD.TYPES.UNITY, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.unitySlot2" 
                                        :src="game.player1.unitySlot2.asset.src"
                                        :class="{'selected-card': game.player1.unitySlot2 == game.activePlayer.selectedCard && game.isAttackPhase()}"
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.unitySlot2"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot unity" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="unityClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UNITY_SLOT_3, CONSTANTS.CARD.TYPES.UNITY, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.unitySlot3" 
                                        :src="game.player1.unitySlot3.asset.src"
                                        :class="{'selected-card': game.player1.unitySlot3 == game.activePlayer.selectedCard && game.isAttackPhase()}"
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.unitySlot3"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UNITY.name}}</span>
                                </div>
                            </div>
                            <div class="slot deck" :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}">                                
                                <div class="info">
                                    <img v-if="game.player1.deck.cards.length > 0" :src="game.player1.deck.back.src" width="100%" height="100%">
                                    <span>Deck: {{game.player1.deck.cards.length}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="slots back">
                            <div 
                                class="slot structure" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="structureClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.STRUCTURE_SLOT_1, CONSTANTS.CARD.TYPES.STRUCTURE, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.structureSlot1" 
                                        :src="game.player1.structureSlot1.asset.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.structureSlot1"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.STRUCTURE.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot utility" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="utilityClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.UTILITY_SLOT, CONSTANTS.CARD.TYPES.UTILITY, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.utilitySlot" 
                                        :src="game.player1.utilitySlot.asset.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.utilitySlot"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.UTILITY.name}}</span>
                                </div>
                            </div>
                            <div 
                                class="slot structure" 
                                :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}"
                                :class="structureClassObjectPlayer1"
                                @click="CardAction(CONSTANTS.GAME.SLOTS.STRUCTURE_SLOT_2, CONSTANTS.CARD.TYPES.STRUCTURE, game.player1)"
                            >
                                <div class="info">
                                    <img 
                                        v-if="game.player1.structureSlot2" 
                                        :src="game.player1.structureSlot2.asset.src" 
                                        width="100%" height="100%"
                                        @mouseover="hoveredCard = game.player1.structureSlot2"
                                        @mouseleave="hoveredCard = null"
                                    >
                                    <span>{{CONSTANTS.CARD.TYPES.STRUCTURE.name}}</span>
                                </div>
                            </div>
                            <div class="slot discard" :style="{width: CONSTANTS.CARD.SIZES.WIDTH + 'px', height: CONSTANTS.CARD.SIZES.HEIGHT + 'px'}">
                                <div class="info">
                                    <img v-if="game.player1.discard.length" :src="game.player1.discard[game.player1.discard.length - 1].asset.src" width="100%" height="100%">
                                    <span>Discard: {{game.player1.discard.length}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="hand">
                            <img 
                                v-for="card in game.player1.hand" 
                                :src="card.asset.src" 
                                :width="CONSTANTS.CARD.SIZES.WIDTH" 
                                :height="CONSTANTS.CARD.SIZES.HEIGHT"
                                :class="{'selected-card': card == game.activePlayer.selectedCard}" 
                                @click="SelectCard(card)"
                                @mouseover="hoveredCard = card"
                                @mouseleave="hoveredCard = null"
                            >
                        </div>
                    </div>
                </div>
                <div class="nav-bar" @click="game.activePlayer.selectedCard = null">
                    <div class="phase-manager">
                        <button class="btn" :disabled="game.activePlayer != game.player2 || game.phase != CONSTANTS.GAME.PHASES.START" @click="DrawPhase">Draw</button>
                        <button class="btn" :disabled="game.activePlayer != game.player2 || game.phase != CONSTANTS.GAME.PHASES.DRAW" @click="PositionPhase">Position</button>
                        <button class="btn" :disabled="game.activePlayer != game.player2 || game.phase != CONSTANTS.GAME.PHASES.POSITION" @click="AttackPhase">Attack</button>
                        <button class="btn" :disabled="game.activePlayer != game.player2 || game.phase != CONSTANTS.GAME.PHASES.ATTACK" @click="EndPhase">End</button>
                    </div>
                    <div class="card-showcase">
                        <div class="showcase">
                            <img 
                                v-if="hoveredCard && game.activePlayer == game.player2" 
                                :src="hoveredCard.asset.src" 
                                width="100%" height="100%"
                            >
                        </div>
                        <div class="info">
                            <div v-if="hoveredCard && game.activePlayer == game.player2">
                                <h1>HP: {{hoveredCard.currentHP}}</h1>
                                <h1>ATK: {{hoveredCard.currentATK}}</h1>
                                <h1>COST: {{hoveredCard.currentCost}}</h1>
                            </div>
                        </div>
                        <div class="options">

                        </div>
                    </div>
                    <div class="phase-manager">
                        <h1>Turn: {{game.activePlayer.name}}</h1>
                        <h1>Coins: {{game.activePlayer.coins}}</h1>
                        <h1>Round: {{game.round}}</h1>
                        <h1 v-if="game.phase">{{game.phase}}</h1>
                    </div>
                    <div class="card-showcase">
                        <div class="showcase">
                            <img 
                                v-if="hoveredCard && game.activePlayer == game.player1" 
                                :src="hoveredCard.asset.src" 
                                width="100%" height="100%"
                            >
                        </div>
                        <div class="info">
                            <div v-if="hoveredCard && game.activePlayer == game.player1">
                                <h1>HP: {{hoveredCard.currentHP}}</h1>
                                <h1>ATK: {{hoveredCard.currentATK}}</h1>
                                <h1>COST: {{hoveredCard.currentCost}}</h1>
                            </div>
                        </div>
                        <div class="options">

                        </div>
                    </div>
                    <div class="phase-manager">
                        <button class="btn" :disabled="game.activePlayer != game.player1 || game.phase != CONSTANTS.GAME.PHASES.START" @click="DrawPhase">Draw</button>
                        <button class="btn" :disabled="game.activePlayer != game.player1 || game.phase != CONSTANTS.GAME.PHASES.DRAW" @click="PositionPhase">Position</button>
                        <button class="btn" :disabled="game.activePlayer != game.player1 || game.phase != CONSTANTS.GAME.PHASES.POSITION" @click="AttackPhase">Attack</button>
                        <button class="btn" :disabled="game.activePlayer != game.player1 || game.phase != CONSTANTS.GAME.PHASES.ATTACK" @click="EndPhase">End</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script src="./source/vue.js"></script>
<script type="module">
    import Game from './engine/Game.js';
    import {
        Unity,
        Utility,
        Structure,
        DefaultUnity
    } from './classes/cards/Imports.js';
    import Deck from './classes/Deck.js';
    import Player from './classes/Player.js';
    import CONSTANTS, { GLOBALS } from './classes/Constants.js';

    const app = new Vue({
        el: "#app",
        data: {
            game: null,
            CONSTANTS: CONSTANTS,
            GLOBALS: GLOBALS,
            hoveredCard: null,
        },
        mounted: function(){
            this.StartGame();
        },
        methods: {
            StartGame: function(){
                this.SetupGame();
                this.game.Start();
            },
            SetupGame: function(){
                var cardsPlayer1 = [
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                ];
                var cardsPlayer2 = [
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                    new DefaultUnity(),
                ];

                var deck1 = new Deck("Deck Teste", cardsPlayer1, this.GLOBALS.ASSETS.DEFAULT_UNITY);
                var player1 = new Player("PLAYER1", deck1);

                var deck2 = new Deck("Deck Teste 1", cardsPlayer2, this.GLOBALS.ASSETS.DEFAULT_UNITY);
                var player2 = new Player("PLAYER2", deck2)

                this.game = new Game()
                this.game.player1 = player1;
                this.game.player2 = player2;
            },
            DrawPhase: function(){
                this.game.DrawPhase();
            },
            PositionPhase: function(){
                this.game.PositionPhase();
            },
            AttackPhase: function(){
                this.game.AttackPhase();
            },
            EndPhase: function(){
                this.game.EndPhase();
            },            
            SelectCard: function(card){
                this.game.PrepareCardSelection(card);
            },
            CardAction: function(slot, type, player){     
                this.game.PrepareCardAction(slot, type, player);
            }
        },
        computed: {
            unityClassObjectPlayer1: function () {
                return {
                    'btn btn-slot': (this.game.activePlayer == this.game.player1 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Unity))
                                    || (this.game.isAttackPhase() && this.game.activePlayer == this.game.player2 && this.game.activePlayer.selectedCard != null),
                }
            },
            utilityClassObjectPlayer1: function () {
                return {
                    'btn btn-slot': this.game.activePlayer == this.game.player1 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Utility),
                }
            },
            structureClassObjectPlayer1: function () {
                return {
                    'btn btn-slot': this.game.activePlayer == this.game.player1 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Structure),
                }
            },
            unityClassObjectPlayer2: function () {
                return {
                    'btn btn-slot': (this.game.activePlayer == this.game.player2 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Unity)) 
                                    || (this.game.isAttackPhase() && this.game.activePlayer == this.game.player1 && this.game.activePlayer.selectedCard != null),
                }
            },
            utilityClassObjectPlayer2: function () {
                return {
                    'btn btn-slot': this.game.activePlayer == this.game.player2 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Utility),
                }
            },
            structureClassObjectPlayer2: function () {
                return {
                    'btn btn-slot': this.game.activePlayer == this.game.player2 && this.game.isPositionPhase() && (this.game.activePlayer.selectedCard && this.game.activePlayer.selectedCard instanceof Structure),
                }
            }
        }
    });
</script>